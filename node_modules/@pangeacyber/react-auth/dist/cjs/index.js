"use strict";var e=require("react/jsx-runtime"),t=require("react"),s=require("axios");function o(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var o=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}var r=o(require("jose"));class a{constructor(e,t=!1){if(!e.clientToken)throw new Error("A token is required");if(!e.domain)throw new Error("A domain is required");e.callbackUri||"undefined"==typeof window||(e.callbackUri=window.location.origin),this.config={...e}}async logout(e){const t={token:e};return await this.post("client/session/logout",t)}async validate(e){const t={token:e};return await this.post("client/token/check",t)}async userinfo(e){const t={code:e};return await this.post("client/userinfo",t)}async refresh(e,t){const s={user_token:e,refresh_token:t};return await this.post("client/session/refresh",s)}async jwks(){return await this.post("client/jwks",{})}async post(e,t){try{const o=await s.post(this.getUrl(e),t,this.getOptions());return{success:"Success"===o.data?.status,response:o.data}}catch(e){return{success:!1,response:this.getError(e)}}}getUrl(e){return`${this.config.domain.match(/^local\.?host(:\d{2,5})?$/)?"http":"https"}://authn.${this.config.domain}/v1/${e}`}getOptions(){return{headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.clientToken}`}}}getError(e){const t={status:"Error",summary:"",result:{}};return s.isAxiosError(e)&&e.response?(t.status=e.response.data.status,t.summary=e.response.data.summary,t.result=e.response.data.result):e.request?(t.summary=`${e.request.status} ${e.request.statusText}`,t.result=e.reqest):(t.summary="Unhandled error",t.result=e,console.log("Unhandled error",e)),t}}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var i=function(e,t,s,o){var r=-1,a=null==e?0:e.length;for(o&&a&&(s=e[++r]);++r<a;)s=t(s,e[r],r,e);return s};var c=function(e){return function(t){return null==e?void 0:e[t]}}({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),l="object"==typeof n&&n&&n.Object===Object&&n,u="object"==typeof self&&self&&self.Object===Object&&self,p=(l||u||Function("return this")()).Symbol;var f=function(e,t){for(var s=-1,o=null==e?0:e.length,r=Array(o);++s<o;)r[s]=t(e[s],s,e);return r},d=Array.isArray,w=p,h=Object.prototype,m=h.hasOwnProperty,S=h.toString,_=w?w.toStringTag:void 0;var k=function(e){var t=m.call(e,_),s=e[_];try{e[_]=void 0;var o=!0}catch(e){}var r=S.call(e);return o&&(t?e[_]=s:delete e[_]),r},g=Object.prototype.toString;var y=k,v=function(e){return g.call(e)},x=p?p.toStringTag:void 0;var C=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":x&&x in Object(e)?y(e):v(e)},b=function(e){return null!=e&&"object"==typeof e};var E=f,A=d,F=function(e){return"symbol"==typeof e||b(e)&&"[object Symbol]"==C(e)},I=p?p.prototype:void 0,T=I?I.toString:void 0;var R=function e(t){if("string"==typeof t)return t;if(A(t))return E(t,e)+"";if(F(t))return T?T.call(t):"";var s=t+"";return"0"==s&&1/t==-Infinity?"-0":s},M=R;var O=function(e){return null==e?"":M(e)},P=c,L=O,N=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var j=function(e){return(e=L(e))&&e.replace(N,P).replace($,"")},U=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var V=function(e){return e.match(U)||[]},Y=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var D=function(e){return Y.test(e)},W="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",q="["+W+"]",J="\\d+",z="[\\u2700-\\u27bf]",K="[a-z\\xdf-\\xf6\\xf8-\\xff]",G="[^\\ud800-\\udfff"+W+J+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Z="(?:\\ud83c[\\udde6-\\uddff]){2}",H="[\\ud800-\\udbff][\\udc00-\\udfff]",B="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Q="(?:"+K+"|"+G+")",X="(?:"+B+"|"+G+")",ee="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",te="[\\ufe0e\\ufe0f]?"+ee+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",Z,H].join("|")+")[\\ufe0e\\ufe0f]?"+ee+")*"),se="(?:"+[z,Z,H].join("|")+")"+te,oe=RegExp([B+"?"+K+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[q,B,"$"].join("|")+")",X+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[q,B+Q,"$"].join("|")+")",B+"?"+Q+"+(?:['’](?:d|ll|m|re|s|t|ve))?",B+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",J,se].join("|"),"g");var re=V,ae=D,ne=O,ie=function(e){return e.match(oe)||[]};var ce=i,le=j,ue=function(e,t,s){return e=ne(e),void 0===(t=s?void 0:t)?ae(e)?ie(e):re(e):e.match(t)||[]},pe=RegExp("['’]","g");var fe=function(e){return function(t){return ce(ue(le(t).replace(pe,"")),e,"")}}((function(e,t,s){return e+(s?"_":"")+t.toLowerCase()}));const de="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",we=e=>{let t="";const s=de.length;for(let o=0;o<e;o++)t+=de.charAt(Math.floor(Math.random()*s));return t},he=e=>Object.keys(e).map((t=>encodeURIComponent(fe(t))+"="+encodeURIComponent(e[t]))).join("&"),me=(e,t)=>{const s=(e.getTime()-t.getTime())/1e3;return Math.round(s)},Se={useCookie:!1,cookieMaxAge:172800,cookieName:"pangea-token",refreshCookieName:"pangea-refresh"},_e=/[?&]code=[^&]+/,ke=/[?&]state=[^&]+/,ge=(e=window.location.search)=>_e.test(e)&&ke.test(e);function ye(e){return e?window.sessionStorage:window.localStorage}const ve=(e,t)=>{const s=ye(t.useCookie),o=JSON.stringify(e);s.setItem(t.sessionKey,o)},xe=e=>{const t=ye(e.useCookie).getItem(e.sessionKey);return t?JSON.parse(t):{}},Ce=e=>{if(e.useCookie)return Fe(e.cookieName);return xe(e)?.user?.active_token?.token},be=e=>{const t=Ce(e)||"",s=(e=>e.useCookie?Fe(e.refreshCookieName):xe(e)?.user?.refresh_token?.token)(e)||"";return{sessionToken:t,refreshToken:s}},Ee=e=>{if(e.useCookie)return Ae(e.cookieName);const t=xe(e);return[t?.user?.refresh_token?.token||"",t?.user?.refresh_token?.expire||""]},Ae=e=>{const t=Re()[e]||"",[s,o]=t.split(",");return[s||"",o||""]},Fe=e=>{const t=Re()[e];if(t){const[e]=t.split(",");return e||""}return""},Ie=e=>{const t=new Date(e);return me(t,new Date)<25},Te=(e,t)=>{const{cookieDomain:s}=t;var o;return"localhost"!==(o=window.location.hostname)&&"127.0.0.1"!==o&&(e+="; Secure",void 0!==s&&(e+=`; domain=${s}`)),e},Re=()=>document.cookie.split(";").map((e=>e.trim())).reduce(((e,t)=>{const[s,o]=t.split("=");return""!==s&&(e[s]=o),e}),{}),Me=(e,t="",s)=>{const{cookieMaxAge:o}=s;let r=`${e}=${t}; path=/; max-age=${o}`;r=Te(r,s),document.cookie=r},Oe=(e,t)=>{let s=`${e}=; path=/; expires=${new Date(0).toUTCString()}; max-age=0`;s=Te(s,t),document.cookie=s},Pe=(e,t)=>{const s=e.active_token?.token||"",o=e.refresh_token?.token||"",r=`${s},${e.active_token?.expire||""}`,a=`${o},${e.refresh_token?.expire||""}`;Me(t.cookieName,r,t),Me(t.refreshCookieName,a,t)},Le=e=>{Oe(e.cookieName,e),Oe(e.refreshCookieName,e)},Ne=e=>{const t=e.result?.active_token?.token?{...e.result.active_token}:{...e.result},s=e.result?.refresh_token?.token?{...e.result.refresh_token}:{},o=t.email,r={...t.profile};delete t.email,delete t.profile,delete s.email,delete s.profile;return{email:o,profile:r,active_token:t,refresh_token:s}},$e=(e,s,o)=>{const a=t.useCallback((async()=>{const{success:t,response:s}=await e.jwks();if(t){if(s.result?.keys&&s.result.keys.length>0)return{keys:s.result.keys};console.warn("Error: empty JWKS response")}}),[]),n=t.useCallback((e=>{if(e?.expire){const t=new Date(e?.expire);return me(new Date,t)<86400}return!1}),[]),i=t.useCallback((async()=>{const e=localStorage.getItem("jwks-cache"),t=JSON.parse(e||"{}");if(e&&n(t))return t.keySet;{const e=await a();if(e){const t={expire:Date.now(),keySet:e};return localStorage.setItem("jwks-cache",JSON.stringify(t)),e}return{keys:[]}}}),[]),c=t.useCallback((async e=>{const t={};try{const s=await i();if(s?.keys?.length>0){const o=r.createLocalJWKSet(s),{payload:a,protectedHeader:n}=await r.jwtVerify(e,o),i=a.profile,c={email:a.email,profile:{first_name:i?.first_name,last_name:i?.first_name,phone:i?.phone},header:n,payload:a};t.user=c}else t.error="Missing JSON Web Key Set"}catch(e){console.warn("Error:",e),t.error="JWT validation failed"}return t}),[]),l=t.useCallback((async t=>{const{success:o,response:r}=await e.validate(t),a={};return o?a.user=Ne(r):(Le(s),a.error=r?.result?.summary||"Token verification error"),a}),[]);return t.useCallback((async e=>{const t=s?.useJwt?await c(e):await l(e);if(o(t),t.user){const e=xe(s);e&&(t.user.active_token=e.user?.active_token,t.user.refresh_token=e.user?.refresh_token)}return t?.user}),[])},je=(e,s,o,r)=>{const a=t.useRef(null);t.useEffect((()=>(window.addEventListener("focus",i),window.addEventListener("blur",n),()=>{window.removeEventListener("focus",i),window.removeEventListener("blur",n),a.current&&(clearInterval(a.current),a.current=null)})),[]);const n=t.useCallback((()=>{a.current&&(clearInterval(a.current),a.current=null)}),[]),i=t.useCallback((()=>{r(!0),c(),r(!1),u()}),[]),c=t.useCallback((()=>{const e=(e=>{if(e.useCookie){const[t,s]=Ae(e.cookieName);return s}return xe(e).user?.refresh_token?.expire||""})(s);e&&Ie(e)&&p()}),[]),l=t.useCallback((()=>{a.current&&(clearInterval(a.current),a.current=null)}),[]),u=t.useCallback((()=>{l(),a.current=window.setInterval((()=>{c()}),15e3)}),[]),p=t.useCallback((async()=>{const{sessionToken:t,refreshToken:r}=be(s),{success:a,response:n}=await e.refresh(t,r);if(a){const e=xe(s),t=Ne(n);e.user=t,ve(e,s),s.useCookie&&Pe(t,s),o({user:t})}else o({error:"Refresh failed"})}),[]);return{refresh:p,startTokenWatch:u,stopTokenWatch:l}},Ue=t.createContext({}),Ve=t.createContext({}),Ye=()=>t.useContext(Ve);var De;exports.FlowStep=void 0,(De=exports.FlowStep||(exports.FlowStep={})).START="start",De.SIGNUP="signup",De.SIGNUP_PASSWORD="signup/password",De.SIGNUP_SOCIAL="signup/social",De.VERIFY_SOCIAL="verify/social",De.VERIFY_PASSWORD="verify/password",De.VERIFY_CAPTCHA="verify/captcha",De.VERIFY_EMAIL="verify/email",De.ENROLL_MFA_SELECT="enroll/mfa/select",De.ENROLL_MFA_START="enroll/mfa/start",De.ENROLL_MFA_COMPLETE="enroll/mfa/complete",De.VERIFY_MFA_SELECT="verify/mfa/select",De.VERIFY_MFA_START="verify/mfa/start",De.VERIFY_MFA_COMPLETE="verify/mfa/complete",De.RESET_PASSWORD="reset/password",De.MFA_SELECT="mfa/select",De.COMPLETE="complete";const We={signin:!0,signup:!0},qe={step:exports.FlowStep.START,flowId:"",email:"",selectedMfa:"",mfaProviders:[],cancelMfa:!0,recaptchaKey:"",qrCode:"",passwordSignup:!0,socialSignup:{},verifyProvider:{},redirectUri:""};class Je extends a{constructor(e,t){super(e),this.options={...We,...t},this.state={...qe}}initState(e){this.state={...this.state,...e}}async start(e){const t=`flow/${exports.FlowStep.START}`,s=[];this.options.signup&&s.push("signup"),this.options.signin&&s.push("signin");const o={cb_uri:this.config.callbackUri,flow_types:s};e.email&&(o.email=e.email);const{success:r,response:a}=await this.post(t,o,!1);return r&&(o.email?(this.state.step=a.result?.next_step,this.state.email=o.email,a.result?.verify_social&&(this.state.verifyProvider={...a.result?.verify_social})):(null===a.result?.signup?.password_signup&&(this.state.passwordSignup=!0),a.result?.signup?.social_signup&&(this.state.socialSignup={...a.result.signup.social_signup})),this.state.flowId=a.result.flow_id,a.result?.verify_captcha?.site_key&&(this.state.recaptchaKey=a.result.verify_captcha.site_key)),{success:r,response:a}}async signupPassword(e){const t=`flow/${exports.FlowStep.SIGNUP_PASSWORD}`,s={flow_id:this.state.flowId,first_name:e.firstName,last_name:e.lastName,password:e.password};return await this.post(t,s)}async signupSocial(e){const t=`flow/${exports.FlowStep.SIGNUP_SOCIAL}`,s={flow_id:this.state.flowId,cb_code:e.cbCode,cb_state:e.cbState};return await this.post(t,s)}async verifySocial(e){const t=`flow/${exports.FlowStep.VERIFY_SOCIAL}`,s={flow_id:this.state.flowId,cb_code:e.cbCode,cb_state:e.cbState};return await this.post(t,s)}async verifyPassword(e){const t=`flow/${exports.FlowStep.VERIFY_PASSWORD}`,s={flow_id:this.state.flowId};return e.reset?s.reset=!0:s.password=e.password,await this.post(t,s)}async verifyCaptcha(e){const t=`flow/${exports.FlowStep.VERIFY_CAPTCHA}`,s={flow_id:this.state.flowId,code:e.captchaCode};return await this.post(t,s)}async verifyEmail(e){const t=`flow/${exports.FlowStep.VERIFY_EMAIL}`,s={flow_id:this.state.flowId,cb_code:e.cbCode,cb_state:e.cbState};return await this.post(t,s)}async enrollMfaStart(e){const t=`flow/${exports.FlowStep.ENROLL_MFA_START}`,s={flow_id:this.state.flowId,mfa_provider:e.mfaProvider};"sms_otp"===e.mfaProvider&&e.phoneNumber&&(s.phone=e.phoneNumber);const{success:o,response:r}=await this.post(t,s);return o&&(r.result?.enroll_mfa_complete?.totp_secret?.qr_image&&(this.state.qrCode=r.result.enroll_mfa_complete.totp_secret.qr_image),this.state.step=r.result?.next_step),{success:o,response:r}}async enrollMfaComplete(e){const t=`flow/${exports.FlowStep.ENROLL_MFA_COMPLETE}`,s={flow_id:this.state.flowId};return e.cancel?s.cancel=!0:s.code=e.code,await this.post(t,s)}async verifyMfaStart(e){const t=`flow/${exports.FlowStep.VERIFY_MFA_START}`,s={flow_id:this.state.flowId,mfa_provider:e.mfaProvider};return await this.post(t,s)}async verifyMfaComplete(e){const t=`flow/${exports.FlowStep.VERIFY_MFA_COMPLETE}`,s={flow_id:this.state.flowId};return e.cancel?s.cancel=!0:s.code=e.code,await this.post(t,s)}async resetPassword(e){const t=`flow/${exports.FlowStep.RESET_PASSWORD}`,s={flow_id:this.state.flowId};return e.cancel?s.cancel=!0:(s.password=e.password,s.cb_code=e.cbCode,s.cb_state=e.cbState),await this.post(t,s)}async complete(){const e=`flow/${exports.FlowStep.COMPLETE}`,t={flow_id:this.state.flowId};return await this.post(e,t)}reset(){this.state={...qe}}async post(e,t,o=!0){try{const r=await s.post(this.getUrl(e),t,this.getOptions()),a=this.processResponse(r.data,o);return this.state.step===exports.FlowStep.COMPLETE?await this.complete():this.state.step===exports.FlowStep.VERIFY_MFA_START?await this.verifyMfaStart({mfaProvider:this.state.selectedMfa||""}):this.state.step===exports.FlowStep.ENROLL_MFA_START&&"sms_otp"!==this.state.selectedMfa?await this.enrollMfaStart({mfaProvider:this.state.selectedMfa||""}):{success:a,response:r.data}}catch(e){return{success:!1,response:this.getError(e)}}}processResponse(e,t=!0){let s="Success"===e.status;return s&&t?(e.result?.verify_mfa_start?.mfa_providers?this.state.mfaProviders=null===e.result?.verify_mfa_start?.mfa_providers?[]:[...e.result.verify_mfa_start.mfa_providers]:e.result?.enroll_mfa_start?.mfa_providers&&(this.state.mfaProviders=null===e.result?.enroll_mfa_start?.mfa_providers?[]:[...e.result.enroll_mfa_start.mfa_providers]),!this.state.selectedMfa&&this.state.mfaProviders?.length&&(this.state.selectedMfa=this.state.mfaProviders[0]),e.result?.error&&(s=!1),this.state.step=e.result?.next_step):!s&&t&&e.result?.next_step&&(this.state.step=e.result.next_step),s}}const ze=t.createContext({});exports.AuthFlowProvider=({children:s})=>{const{client:o,cbParams:r,setFlowComplete:a}=Ye(),n={clientToken:o.config.clientToken,domain:o.config.domain,callbackUri:o.config.callbackUri},i=t.useMemo((()=>new Je(n)),[]),[c,l]=t.useState(),[u,p]=t.useState(),[f,d]=t.useState(!1),[w,h]=t.useState({});t.useEffect((()=>{const e=S(),t={step:e.step||exports.FlowStep.START},s=r?.code,o=r?.state;e.step&&(t.flowId=e.flow_id,t.recaptchaKey=e.recaptcha_key,t.qrCode=e.qr_code,t.selectedMfa=e.selected_mfa,t.mfaProviders=e.mfa_providers,t.email=e.email,h(t)),l(t.step),i.initState(t),t.step===exports.FlowStep.START&&s&&o&&t.flowId?m(exports.FlowStep.SIGNUP_SOCIAL,{cbCode:s,cbState:o}):t.step===exports.FlowStep.START?m(exports.FlowStep.START,{}):t.step===exports.FlowStep.VERIFY_SOCIAL&&s&&o?m(exports.FlowStep.VERIFY_SOCIAL,{cbCode:s,cbState:o}):t.step===exports.FlowStep.VERIFY_EMAIL&&m(exports.FlowStep.VERIFY_EMAIL,{cbCode:s,cbState:o})}),[]);const m=t.useCallback((async(e,t)=>{switch(d(!0),e){case exports.FlowStep.START:k(t);break;case exports.FlowStep.SIGNUP_PASSWORD:g(t);break;case exports.FlowStep.SIGNUP_SOCIAL:y(t);break;case exports.FlowStep.VERIFY_PASSWORD:v(t);break;case exports.FlowStep.VERIFY_SOCIAL:x(t);break;case exports.FlowStep.VERIFY_EMAIL:C(t);break;case exports.FlowStep.VERIFY_CAPTCHA:b(t);break;case exports.FlowStep.ENROLL_MFA_START:E(t);break;case exports.FlowStep.ENROLL_MFA_COMPLETE:A(t);break;case exports.FlowStep.VERIFY_MFA_START:F(t);break;case exports.FlowStep.VERIFY_MFA_COMPLETE:I(t);break;case exports.FlowStep.RESET_PASSWORD:T(t);break;case exports.FlowStep.ENROLL_MFA_SELECT:i.state.cancelMfa=t.cancel,R(exports.FlowStep.ENROLL_MFA_SELECT);break;case exports.FlowStep.VERIFY_MFA_SELECT:i.state.cancelMfa=t.cancel,R(exports.FlowStep.VERIFY_MFA_SELECT);break;default:console.log("Invalid Flow State",e)}d(!1)}),[w]),S=()=>{const e=localStorage.getItem("pangea-authn-flow");if(e){return JSON.parse(e)}return{}},_=t.useCallback((e=>{const t=S();t.step=e.step,t.flow_id=e.flowId,t.email=e.email,t.selected_mfa=e.selectedMfa,t.mfa_providers=e.mfaProviders,t.recaptcha_key=e.recaptchaKey,t.qr_code=e.qrCode;const s=JSON.stringify(t);localStorage.setItem("pangea-authn-flow",s)}),[]),k=async e=>{const{success:t,response:s}=await i.start(e);O(t,s)},g=async e=>{const{success:t,response:s}=await i.signupPassword(e);O(t,s)},y=async e=>{const{success:t,response:s}=await i.signupSocial(e);O(t,s)},v=async e=>{const{success:t,response:s}=await i.verifyPassword(e);O(t,s)},x=async e=>{const{success:t,response:s}=await i.verifySocial(e);O(t,s)},C=async e=>{const{success:t,response:s}=await i.verifyEmail(e);O(t,s)},b=async e=>{const{success:t,response:s}=await i.verifyCaptcha(e);O(t,s)},E=async e=>{const{success:t,response:s}=await i.enrollMfaStart(e);O(t,s)},A=async e=>{e.cancel&&e.mfaProvider&&(i.state.selectedMfa=e.mfaProvider);const{success:t,response:s}=await i.enrollMfaComplete(e);O(t,s)},F=async e=>{const{success:t,response:s}=await i.verifyMfaStart(e);O(t,s)},I=async e=>{e.cancel&&e.mfaProvider&&(i.state.selectedMfa=e.mfaProvider);const{success:t,response:s}=await i.verifyMfaComplete(e);O(t,s)},T=async e=>{e.cancel||(e.cbCode=r?.code,e.cbState=r?.state);const{success:t,response:s}=await i.resetPassword(e);O(t,s)},R=e=>{i.state.step=e,l(i.state.step),h({...i.state}),_(i.state)},M=t.useCallback((()=>{i.reset(),p(void 0),m(exports.FlowStep.START,{})}),[i,m]),O=(e,t)=>{e?(p(void 0),l(i.state.step),h({...i.state}),void 0===i.state.step&&t.result?.active_token?.token?(localStorage.removeItem("pangea-authn-flow"),a(t)):_(i.state)):(p(t),console.log("Error",t))},P=t.useMemo((()=>({step:c,error:u,loading:f,flowData:w,callNext:m,reset:M,cbParams:r})),[c,u,f,w,m,M,r]);return e.jsx(ze.Provider,{value:P,children:s})},exports.AuthNClient=a,exports.AuthNFlowClient=Je,exports.AuthProvider=({loginUrl:s,config:o,onLogin:r,cookieOptions:n={useCookie:!1},redirectPathname:i,redirectOnLogout:c=!1,useStrictStateCheck:l=!0,children:u})=>{const[p,f]=t.useState(!1),[d,w]=t.useState(!0),[h,m]=t.useState(""),[S,_]=t.useState(),k=t.useMemo((()=>new a(o)),[o]),g=/\/$/,y=`${s.replace(g,"")}/authorize`,v=`${s.replace(g,"")}/signup`,x=`${s.replace(g,"")}/logout`,C={useJwt:o.useJwt,sessionKey:o.sessionKey||"pangea-session",...Se,...n},b=t.useCallback((e=>{if(e.user){const t=xe(C);if(f(!0),_(e.user),r){const e={userData:t.user,returnPath:window.location.pathname};r(e)}}else m(e.error||"Validation failed.");w(!1)}),[]),E=t.useCallback((e=>{e.user?(_(e.user),f(!0)):P(),w(!1)}),[]),A=t.useCallback((e=>{w(e)}),[]),F=$e(k,C,b),{refresh:I,startTokenWatch:T,stopTokenWatch:R}=je(k,C,E,A);t.useEffect((()=>{const[e,t]=Ee(C);ge()?M():e?(t&&Ie(t)?I():F(e),T()):w(!1)}),[]);const M=async()=>{const e=window.location.search,t=new URLSearchParams(e),s=ye(C.useCookie),r=s.getItem("state"),a=t.get("state"),n=t.get("code");t.delete("state"),t.delete("code");const i=t.toString(),c=i?`${window.location.pathname}?${i}`:window.location.pathname;if(history.pushState({},document.title,c),a&&n)if(a!==r&&l){m("Invalid session state"),w(!1)}else{const{success:e,response:t}=await k.userinfo(n);if(e){const e=t.result?.active_token?.token;if(e)(!o?.useJwt||o?.useJwt&&await F(e))&&$(t);else{m("Missing Token")}}else m(t.summary);s.removeItem("state"),w(!1)}else{m("Missing required parameters"),w(!1)}},O=()=>{const e=window.location,t=window.location.search,s=new URLSearchParams(t),o=we(32),r=ye(C.useCookie);r.setItem("state",o),r.setItem("last-path",`${e.pathname}${e.search}`);let a=e.origin;"string"==typeof i&&(a+=i);const n=new URLSearchParams("");n.append("redirect_uri",a),n.append("state",o);const c=n.toString(),l=s.get("signup")?v:y,u=c?`${l}?${c}`:l;window.location.replace(u)},P=t.useCallback((async()=>{const e=we(32);if(c){let t=location.origin;"string"==typeof i&&(t+=i);const s=`${x}?${he({redirectUri:t,state:e})}`;N(),window.location.replace(s)}else{const e=Ce(C);if(e){const{success:t,response:s}=await k.logout(e);t?N():m(s.summary)}else N()}}),[]),L=t.useCallback((()=>Ce(C)),[]),N=()=>{C.useCookie&&Le(C),R();ye(C.useCookie).removeItem("pangea-session"),m(""),_(void 0),f(!1)},$=e=>{const t=Ne(e),s=xe(C);s.user=t,ve(s,C);const o=ye(C.useCookie),a={userData:t,returnPath:o.getItem("last-path")||"/",authState:o.getItem("state")};o.removeItem("last-path"),C.useCookie&&Pe(t,C),m(""),_(t),f(!0),T(),r&&r(a)},j=t.useMemo((()=>({authenticated:p,loading:d,error:h,user:S,client:k,login:O,logout:P,getToken:L})),[p,d,h,S,k,O,P,L]);return e.jsx(Ue.Provider,{value:j,children:e.jsx(e.Fragment,{children:u})})},exports.ComponentAuthProvider=({config:s,cookieOptions:o={useCookie:!1},children:r})=>{const[n,i]=t.useState(!1),[c,l]=t.useState(!0),[u,p]=t.useState(),[f,d]=t.useState(),[w,h]=t.useState(),m=t.useMemo((()=>new a(s)),[s]),S={useJwt:s.useJwt,sessionKey:s.sessionKey||"pangea-session",...Se,...o},_=t.useCallback((e=>{e.user?(i(!0),d(e.user)):A(),l(!1)}),[]),k=t.useCallback((e=>{e.user?(d(e.user),i(!0)):b(),l(!1)}),[]),g=t.useCallback((e=>{l(e)}),[]),y=$e(m,S,_),{refresh:v,startTokenWatch:x,stopTokenWatch:C}=je(m,S,k,g);t.useEffect((()=>{const[e,t]=Ee(S);if(ge()){const e=window.location.search,t=new URLSearchParams(e),s=t.get("state")||"",o=t.get("code")||"";h({state:s,code:o})}e?(t&&Ie(t)?v():y(e),x()):l(!1)}),[]);const b=t.useCallback((async()=>{const e=Ce(S);if(e){const{success:t,response:s}=await m.logout(e);t?A():p(s)}else A();C()}),[f]),E=t.useCallback((()=>Ce(S)),[]),A=()=>{S.useCookie&&Le(S),p(void 0),d(void 0),i(!1)},F=t.useCallback((e=>{const t=Ne(e),s=xe(S);s.user=t,ve(s,S),S.useCookie&&Pe(t,S),p(void 0),d(t),i(!0),x()}),[]),I=t.useMemo((()=>({authenticated:n,loading:c,error:u,user:f,cbParams:w,client:m,logout:b,getToken:E,setFlowComplete:F})),[n,c,u,f,w,m,b,E,F]);return e.jsx(Ve.Provider,{value:I,children:e.jsx(e.Fragment,{children:r})})},exports.encode58=e=>{if(0===e.length)return"";"string"==typeof e&&(e="undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))));let t=BigInt("0x"+(e=>{let t="";for(let s=0;s<e.length;s++)t+=e[s].toString(16).padStart(2,"0");return t})(e));const s=[];for(;t>0;){const e=Number(t%58n);t/=58n,s.push(de[e])}for(let t=0;0===e[t];t++)s.push(de[0]);return s.reverse().join("")},exports.getTokenFromCookie=Fe,exports.hasAuthParams=ge,exports.toUrlEncoded=he,exports.useAuth=()=>t.useContext(Ue),exports.useAuthFlow=()=>t.useContext(ze),exports.useComponentAuth=Ye;
//# sourceMappingURL=index.js.map
